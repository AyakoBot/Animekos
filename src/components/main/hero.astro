---
import { Image } from "astro:assets";

import Flower from "/public/assets/flower.svg";

const guild = await fetch(
 "https://discord.com/api/v10/invites/wjGas6FB?with_counts=true"
).then((res) =>
 res.ok
  ? res.json()
  : { approximate_member_count: 67000, approximate_presence_count: 20000 }
);

const splitByThousand = (num: number): string => {
 const str = Math.round(num).toString();
 const len = str.length;
 if (len <= 3) return str;
 return `${splitByThousand(parseInt(str.slice(0, len - 3), 10))},${str.slice(len - 3)}`;
};

const online = splitByThousand(guild.approximate_presence_count);
const members = splitByThousand(guild.approximate_member_count);
---

<section
 class="m-auto w-100dvw relative h-85dvh lg:mt-15dvh scale-75 md:scale-100"
>
 <div class="absolute top-0 left-[calc(50%-15cm)]">
  <div class="relative w-125 h-125">
   <div class="relative z-10 w-full h-full">
    <Image
     src={Flower}
     alt=""
     width="4096"
     height="4096"
     class="animate-[flower-rotate_240s_linear_infinite] absolute top-0 left-0 w-120"
     loading="eager"
    />
    <Image
     src={Flower}
     alt=""
     width="4096"
     height="4096"
     class="top-0 left-0 w-120 animate-[flower-rotate_240s_linear_infinite] absolute blur-10px"
     loading="eager"
    />
   </div>
   <div
    class="before:bg-gradient-to-r before:from-transparent before:to-[#18181b] before:content-empty before:absolute before:-top-5% before:-left-5% before:w-110% before:h-110% w-110% h-110% z-20 top-0 left-0 absolute"
   >
   </div>
  </div>
 </div>

 <div class="absolute top-30% left-[calc(50%+7cm)]">
  <div class="relative w-75 h-75">
   <div class="relative z-10 rotate-40deg">
    <Image
     src={Flower}
     alt=""
     width="4096"
     height="4096"
     class="top-0 right-0 animate-[flower-rotate_150s_linear_infinite_reverse] absolute"
     loading="eager"
    />
    <Image
     src={Flower}
     alt=""
     width="4096"
     height="4096"
     class="top-0 right-0 animate-[flower-rotate_150s_linear_infinite_reverse] absolute blur-10px"
     loading="eager"
    />
   </div>
   <div
    class="before:bg-gradient-to-lt before:from-transparent before:to-[#18181b] before:content-[''] before:absolute before:w-110% before:h-110% absolute -top-20% right-37% w-110% h-120% z-20"
   >
   </div>
  </div>
 </div>

 <div class="flex flex-col justify-center items-center">
  <div
   class="font-['Ayar_Juno'] text-30 mt-40 z-100 text-shadow-[0_0_20px] color-[#fecada]"
  >
   ANIMEKOS
  </div>
  <div class="font-['Ayar_Juno'] text-8 z-100 -mt-5 color-[#fecada]">
   art, anime, and friends
  </div>
  <div
   class="flex flex-row justify-evenly items-center gap-10 text-4 color-neutral-4 z-100 mt-5"
  >
   <div>
    <span class="text-3">ðŸŸ¢</span><span id="online">{online} online</span>
   </div>
   <div>
    <span class="text-3">âš«</span><span id="members">{members} members</span>
   </div>
  </div>

  <div class="relative z-40">
   <a
    target="_blank"
    href="https://discord.gg/wjGas6FB"
    class="text-15 z-100 mt-10 inline-flex relative flex items-center justify-center hover:scale-105 transition-all duration-300 ease-in-out
      after:content-empty after:h-full after:w-full after:absolute after:bottom-0 after:z-99 after:animate-[gradient_8s_linear_infinite] after:filter-blur-1.5rem after:[background-image:conic-gradient(from_var(--angle),#423dfc,#4b4bfc,#d4a1c1,#ff52a8,#4dc6ff,#423dfc)]"
    style="--angle: 0deg;"
   >
    <div
     class="z-100 absolute top-0 left-0 w-full h-full
      after:content-empty after:h-full after:w-full after:absolute after:bottom-0 after:z-99 after:animate-[gradient_8s_linear_infinite] after:[background-image:conic-gradient(from_var(--angle),#423dfc,#4b4bfc,#d4a1c1,#ff52a8,#4dc6ff,#423dfc)]"
     style="--angle: 0deg;"
    >
    </div>
    <span
     class="inline-flex h-full w-full cursor-pointer items-center justify-center bg-[#18181b] backdrop-blur-3xl px-4 color-slate-4 border-slate-4 border-solid border-4px z-100 m-2px"
    >
     JOIN NOW
    </span>
   </a>
  </div>
 </div>
</section>
